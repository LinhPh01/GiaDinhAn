import{t as O}from"../../external/@swc/helpers/src/_object_spread.mjs.js.864104b0.js";import{u as _}from"../../utils/lodash.js.932cc367.js";import{e as R}from"../logger.js.1ff5fb47.js";import{n as m}from"../../utils/errorHandler.js.2edec4c2.js";import{E as w,n as E,R as D,S as p,t as v}from"../../constants.js.9c557f4a.js";import{E as U}from"./zaloNative.js.76ac03e6.js";import{A as S}from"../token.js.8e734816.js";import{s as T}from"../../appEnv/getEnv.js.06c427cb.js";import{a as I}from"../../types/enum.js.df3937d6.js";var N,P=(N=function(r){var u,d,i,n=(u=T())===null||u===void 0?void 0:u.platformName,f=r.action.replace("action.","").replace(/\./g,"_").toUpperCase(),a=E[f],l=(a==null?void 0:a.skipJump)||!1,c=(a==null?void 0:a.errorList)||{};if(f==="JUMP_LOGIN")return new m(D.UNKNOWN_ERROR,"Can not get auth code: ".concat(r.error_message));if(S.jumpStatus!==I.DONE&&!l)return new m(p.UNAUTHORIZED.code,p.UNAUTHORIZED.message);if(String(r.error_message).toLowerCase()==="permission required!"||String(r.error_message).toLowerCase()==="no permission!")return new m(p.FORBIDDEN.code,p.FORBIDDEN.message);if(n&&((d=v[n])===null||d===void 0?void 0:d[r.error_code]))return new m(v[n][r.error_code].code,v[n][r.error_code].message);var o=c==null||(i=c[n])===null||i===void 0?void 0:i[String(r.error_code)];if(o){var t,e,s,g=(t=o.mapTo)===null||t===void 0?void 0:t.message;return o!=null&&o.needMoreDetail&&(g="".concat(o==null||(s=o.mapTo)===null||s===void 0?void 0:s.message,": ").concat(r.error_message)),new m((e=o.mapTo)===null||e===void 0?void 0:e.code,g)}return new m(r.error_code,r.error_message)},function(r,u,d,i){var n=function(l,c){function o(t){return function(e){var s=_.isEmpty(c)?void 0:c[t];if(s)return R({stage:w.RESPONSE,type:"log",state:t,name:l,response:e}),s(t==="fail"?N(e):e==null?void 0:e.data)}}return _.isUndefined(l)&&(l=""),Object.assign({},{success:o("success"),fail:o("fail")})}(r,d),f=E[r],a=(i==null?void 0:i.delay)||0;setTimeout(function(){U(r,u,n,O({},i,f))},a)});export{P as f};
