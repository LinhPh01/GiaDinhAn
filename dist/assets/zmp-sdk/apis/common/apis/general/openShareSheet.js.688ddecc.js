import{t as z}from"../../../external/@swc/helpers/src/_async_to_generator.mjs.js.ae57f58a.js";import{t as b}from"../../../external/@swc/helpers/src/_object_spread.mjs.js.864104b0.js";import{e as y}from"../../../external/@swc/helpers/src/_object_spread_props.mjs.js.926c90b1.js";import{f as P}from"../../call/index.js.b4dccad7.js";import{A as _}from"../../token.js.34b36f63.js";import{T as g,r as A,a as T}from"../../../constants.js.e7b682ef.js";import{i as x}from"./getZMPShareInfo.js.23c212f2.js";import{e as O}from"../../../external/tslib/tslib.es6.js.20b0ea63.js";import{l as E}from"../../../types/enum.js.5367e09a.js";import{s as U}from"../../../appEnv/getEnv.js.8915b352.js";var I,V=(I=z(function(o,e){var t,s,h,u,d,i,v,p,l,f,r,c;return O(this,function(a){switch(a.label){case 0:switch(t={},s=o,o){case"text":return[3,1];case"image":return[3,2];case"gif":return[3,3];case"video":return[3,4];case"link":return[3,5];case"oa":return[3,6];case"zmp":return[3,7];case"zmp_deep_link":return[3,10]}return[3,13];case 1:return t={text:e==null?void 0:e.text,desc:(e==null?void 0:e.desc)||(e==null?void 0:e.description),autoParseLink:e!=null&&e.autoParseLink?1:0},[3,14];case 2:return i=[],v=((u=U())===null||u===void 0?void 0:u.zaloVersion)||0,p=((d=U())===null||d===void 0?void 0:d.platformName)||"unknown",Number(v)>=A[p]&&(s="multi_image"),Array.isArray(e==null?void 0:e.imageUrls)&&(e==null?void 0:e.imageUrls.length)>0?i=e==null?void 0:e.imageUrls:i.push(e==null?void 0:e.imageUrl),t={photoUrls:i,photoUrl:e==null?void 0:e.imageUrl,caption:e==null?void 0:e.caption},[3,14];case 3:return t={photoUrl:e==null?void 0:e.imageUrl,gifUrl:e==null?void 0:e.gifUrl,width:e==null?void 0:e.width,height:e==null?void 0:e.height},[3,14];case 4:return t={videoThumb:e==null?void 0:e.videoThumb,videoUrl:e==null?void 0:e.videoUrl,width:e==null?void 0:e.width,height:e==null?void 0:e.height},[3,14];case 5:return t={link:e==null?void 0:e.link,chatOnly:e!=null&&e.chatOnly?1:0},[3,14];case 6:return t={uid:e==null?void 0:e.id},[3,14];case 7:case 10:return[4,_.getAccessToken()];case 8:case 11:return h=a.sent(),[4,x(g,h||"",(e==null?void 0:e.title)||"",(e==null?void 0:e.description)||"",(e==null?void 0:e.thumbnail)||"",e==null?void 0:e.path)];case 9:return l=a.sent(),t={data:{ZInstantAPIInfo:{url:"".concat(l.zinstantApi),zinstantdata_id:"templateId=".concat(l.ztemplateId,"&appId=").concat(g,"&shareId=").concat(l.shareId)},previewMsgText:{msg:{en:"Zalo Mini Program",vi:"Ch\u01B0\u01A1ng tr\xECnh nh\u1ECF"}},enableReactions:1}},[3,14];case 12:return f=a.sent().shareableLink,r=new URL(f),c=r.searchParams.getAll("zshareId"),r.searchParams.delete("zshareId"),c.length>0&&r.searchParams.append("zshareId",c[0]),t={link:r.href,chatOnly:0},[3,14];case 13:return[3,14];case 14:return[2,new Promise(function(k,w){P("OPEN_SHARESHEET",y(b({type:E[s]},t),{zapp:T}),{success:function(n){k({status:n==null?void 0:n.status,shareType:n==null?void 0:n.share_type,numberOfUser:n==null?void 0:n.uid_to_size})},fail:function(n){w(n)}},{timeout:!1})})]}})}),function(o,e){return I.apply(this,arguments)});export{V as p};
